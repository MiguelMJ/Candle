<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Candle: Lights and shadows</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Candle<span id="projectnumber">&#160;v1.0</span>
   </div>
   <div id="projectbrief">2D lighting for SFML</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_doc_md_lights_shadows.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Lights and shadows </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md7">Introduction</a></li>
<li class="level1"><a href="#autotoc_md8">Radial light and Directed light</a></li>
<li class="level1"><a href="#autotoc_md9">Problems with intersections</a></li>
<li class="level1"><a href="#autotoc_md10">Customizing the lights</a><ul><li class="level2"><a href="#autotoc_md11">Common parameters</a><ul><li class="level3"><a href="#autotoc_md12">Intensity</a></li>
<li class="level3"><a href="#autotoc_md13">Color</a></li>
<li class="level3"><a href="#autotoc_md14">Range</a></li>
<li class="level3"><a href="#autotoc_md15">Fade</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md16">RadialLight parameters</a><ul><li class="level3"><a href="#autotoc_md17">Beam angle</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md18">DirectedLight parameters</a><ul><li class="level3"><a href="#autotoc_md19">Beam width</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="lights_shadows"></a></p>
<h1><a class="anchor" id="autotoc_md7"></a>
Introduction</h1>
<p >The two main objects related to shadow casting in Candle are light sources and edges.</p>
<p >For the lights, there is an abstract class called <a class="el" href="classcandle_1_1LightSource.html" title="Interface for objects that emit light.">candle::LightSource</a>, implemented by <a class="el" href="classcandle_1_1RadialLight.html" title="LightSource that emits light from a single point.">candle::RadialLight</a> and <a class="el" href="classcandle_1_1DirectedLight.html" title="LightSource that emits light in a single direction.">candle::DirectedLight</a>. They inherit from sf::Drawable and sf::Transformable, so they can be used as common SFML entities.</p>
<p >For the edges, there is a structure called <a href="LightSource_8hpp.html#a232f746b6098d9a876d23e84a67dc0a2"><b>candle::Edge</b></a>, that can represent a segment by the coordinates of its ends. However, the raycasting function requires that the shadow casting edges are stored in a <code>std::vector</code>, so Candle provides a convenient alias for <code>std::vector&lt;<a class="el" href="LightSource_8hpp.html#a232f746b6098d9a876d23e84a67dc0a2" title="Typedef with mere semantic purposes.">candle::Edge</a>&gt;</code> called <a href="LightSource_8hpp.html#a384b0e96a22f34b27f84a55713279e89"><b>candle::EdgeVector</b></a>. This is what you should be using to manage your edges.</p>
<p >They interact through the function <a class="el" href="classcandle_1_1LightSource.html#a9a6e2a899ebc86948952d68f5fff0f7c" title="Modify the polygon of the illuminated area with a raycasting algorithm.">candle::LightSource::castLight</a>, that takes two iterators from a <a href="LightSource_8hpp.html#a384b0e96a22f34b27f84a55713279e89"><b>candle::EdgeVector</b></a> and use the edges contained between them to compute the area illuminated by the light source.</p>
<p >Let's see with a sample of code.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;SFML/Graphics.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="RadialLight_8hpp.html">Candle/RadialLight.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">    <span class="comment">// create window</span></div>
<div class="line">    sf::RenderWindow w(sf::VideoMode(400, 400), <span class="stringliteral">&quot;app&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// create a light source</span></div>
<div class="line">    <a class="code hl_class" href="classcandle_1_1RadialLight.html">candle::RadialLight</a> light;</div>
<div class="line">    light.<a class="code hl_function" href="classcandle_1_1LightSource.html#a70fa0b021d3e30a5aa1eb1cd24ba483e">setRange</a>(150);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// create an edge pool</span></div>
<div class="line">    <a class="code hl_typedef" href="LightSource_8hpp.html#a384b0e96a22f34b27f84a55713279e89">candle::EdgeVector</a> edges;</div>
<div class="line">    edges.emplace_back(sf::Vector2f(200.f, 100.f), </div>
<div class="line">                       sf::Vector2f(200.f, 300.f));</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// main loop</span></div>
<div class="line">    <span class="keywordflow">while</span>(w.isOpen()){</div>
<div class="line">        sf::Event e;</div>
<div class="line">        <span class="keywordflow">while</span>(w.pollEvent(e)){</div>
<div class="line">            <span class="keywordflow">if</span>(e.type == sf::Event::Closed){</div>
<div class="line">                w.close();</div>
<div class="line">            }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(e.type == sf::Event::MouseMoved){</div>
<div class="line">                sf::Vector2f mp(sf::Mouse::getPosition(w));</div>
<div class="line">                light.setPosition(mp);</div>
<div class="line">                light.<a class="code hl_function" href="classcandle_1_1RadialLight.html#ab4753c89d8598308a771c62923ae5cc7">castLight</a>(edges.begin(), edges.end());</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        w.clear();</div>
<div class="line">        w.draw(light);</div>
<div class="line">        w.display();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aLightSource_8hpp_html_a384b0e96a22f34b27f84a55713279e89"><div class="ttname"><a href="LightSource_8hpp.html#a384b0e96a22f34b27f84a55713279e89">candle::EdgeVector</a></div><div class="ttdeci">std::vector&lt; Edge &gt; EdgeVector</div><div class="ttdoc">Typedef to shorten the use of vectors as edge pools.</div><div class="ttdef"><b>Definition:</b> LightSource.hpp:28</div></div>
<div class="ttc" id="aRadialLight_8hpp_html"><div class="ttname"><a href="RadialLight_8hpp.html">RadialLight.hpp</a></div><div class="ttdoc">This file contains the RadialLight class.</div></div>
<div class="ttc" id="aclasscandle_1_1LightSource_html_a70fa0b021d3e30a5aa1eb1cd24ba483e"><div class="ttname"><a href="classcandle_1_1LightSource.html#a70fa0b021d3e30a5aa1eb1cd24ba483e">candle::LightSource::setRange</a></div><div class="ttdeci">void setRange(float range)</div><div class="ttdoc">Set the range of the illuminated area.</div></div>
<div class="ttc" id="aclasscandle_1_1RadialLight_html"><div class="ttname"><a href="classcandle_1_1RadialLight.html">candle::RadialLight</a></div><div class="ttdoc">LightSource that emits light from a single point.</div><div class="ttdef"><b>Definition:</b> RadialLight.hpp:32</div></div>
<div class="ttc" id="aclasscandle_1_1RadialLight_html_ab4753c89d8598308a771c62923ae5cc7"><div class="ttname"><a href="classcandle_1_1RadialLight.html#ab4753c89d8598308a771c62923ae5cc7">candle::RadialLight::castLight</a></div><div class="ttdeci">void castLight(const EdgeVector::iterator &amp;begin, const EdgeVector::iterator &amp;end) override</div><div class="ttdoc">Modify the polygon of the illuminated area with a raycasting algorithm.</div></div>
</div><!-- fragment --><p >The previous code results in a light that follows the pointer and a vertical edge in the center of the screen.</p>
<div align="center"><img src="example.gif" alt="" width="250px" class="inline"/><br  />
<em>Preview</em></div><p >Note how the <code>castLight</code> function is called only when the mouse is moved. Although it shouldn't be very expensive when a light has a normal amount of edges in range, it is preferable not to abuse it unnecesarily. Therefore, we will call it only when the light has been modified or the edges in range have moved.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Radial light and Directed light</h1>
<p >In the previous example we have used a <a class="el" href="classcandle_1_1RadialLight.html" title="LightSource that emits light from a single point.">candle::RadialLight</a>. This is the light type that casts rays in any direction from a single point. The other type is <a class="el" href="classcandle_1_1DirectedLight.html" title="LightSource that emits light in a single direction.">candle::DirectedLight</a>, that casts rays in a single direction, from any point within a segment.</p>
<table width="100%">
<tr>
<td align="center"><img src="radial_2.png" alt="" width="300px" class="inline"/> <br  />
 <em>Radial lights</em>  </td><td align="center"><img src="directed_2.png" alt="" width="300px" class="inline"/> <br  />
 <em>Directed lights</em>   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md9"></a>
Problems with intersections</h1>
<p >Candle doesn't behave well when segments intersect. The reason is that lights project only to the end of segments, so intersection points, that are within the edge, are ignored.</p>
<table width="100%">
<tr>
<td align="center"><img src="intersection_1.png" alt="Intersection of edges example" width="300px" class="inline"/> <br  />
 <em>First case: Intersection between edges:</em>  </td><td align="center"><img src="intersection_2.png" alt="Intersection of edge and directed light example" width="300px" class="inline"/> <br  />
 <em>Second case: Intersection between an edge and the source of a directed light</em>   </td></tr>
</table>
<p>You should avoid this when placing the edges and lights in the scene.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Customizing the lights</h1>
<p >There are four common parameters to customize light sources, and one parameter specific of each child class.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Common parameters</h2>
<h3><a class="anchor" id="autotoc_md12"></a>
Intensity</h3>
<p >Alpha component of the light, managed separately from the plain color.</p><ul>
<li><a class="el" href="classcandle_1_1LightSource.html#ad21d60c5abe847a6f7bbdf8092c8c1d4" title="Get the intensity of the light.">candle::LightSource::getIntensity</a></li>
<li><a class="el" href="classcandle_1_1LightSource.html#a0ecb09b40144b306b18e8f34236d9a2f" title="Set the light intensity.">candle::LightSource::setIntensity</a></li>
</ul>
<div align="center"> <img src="param_intensity_1.png" alt="Intensity preview" width="300px" class="inline"/> <br  />
 <br  />
<em>Top left: hight intensity. Bottom right: low intensity.</em> </div> <h3><a class="anchor" id="autotoc_md13"></a>
Color</h3>
<p >Plain color of the light.</p>
<ul>
<li><a class="el" href="classcandle_1_1LightSource.html#a1b3c652052b2f265b48a5bc9bcbd5eff" title="Get the plain color of the light.">candle::LightSource::getColor</a></li>
<li><a class="el" href="classcandle_1_1LightSource.html#ad4ad5b2a1bee472465cf5e45799a26dc" title="Set the light color.">candle::LightSource::setColor</a></li>
</ul>
<div align="center"> <img src="param_color_1.png" alt="Color preview" width="300px" class="inline"/> <br  />
<em>Top left: Color cyan. Bottom right: Color yellow.</em> </div> <h3><a class="anchor" id="autotoc_md14"></a>
Range</h3>
<p >Max range of the illuminated area.</p>
<ul>
<li><a class="el" href="classcandle_1_1LightSource.html#a983d51a4fa63300052f1968d2efd159a" title="Get the range of the illuminated area.">candle::LightSource::getRange</a></li>
<li><a class="el" href="classcandle_1_1LightSource.html#a70fa0b021d3e30a5aa1eb1cd24ba483e" title="Set the range of the illuminated area.">candle::LightSource::setRange</a></li>
</ul>
<div align="center"> <img src="param_range_1.png" alt="Range preview" width="300px" class="inline"/> <br  />
<em>Top left: Low range. Bottom right: High range.</em> </div> <h3><a class="anchor" id="autotoc_md15"></a>
Fade</h3>
<p >Flag that indicates if the light fades towards the range limit.</p>
<ul>
<li><a class="el" href="classcandle_1_1LightSource.html#ab7c135dffa305e3c66a7613ddad9acfa" title="Check if the light fades or not.">candle::LightSource::getFade</a></li>
<li><a class="el" href="classcandle_1_1LightSource.html#afa1c4c364033c3d856f1f377cb977495" title="Set the value of the fade flag.">candle::LightSource::setFade</a></li>
</ul>
<div align="center"> <img src="param_fade_1.png" alt="Fade preview" width="300px" class="inline"/> <br  />
<em>Top left: Fade off. Bottom right: Fade on.</em> </div> <h2><a class="anchor" id="autotoc_md16"></a>
RadialLight parameters</h2>
<h3><a class="anchor" id="autotoc_md17"></a>
Beam angle</h3>
<p >Angle (in degrees) that limits the difference between the angles of the casted rays and the rotation of the light.</p>
<ul>
<li><a class="el" href="classcandle_1_1RadialLight.html#a930060cc6139a9bac243e5770e09c057" title="Get the range for which rays may be casted.">candle::RadialLight::getBeamAngle</a></li>
<li><a class="el" href="classcandle_1_1RadialLight.html#ae587e8b69093fe52dd6759e04939079c" title="Set the range for which rays may be casted.">candle::RadialLight::setBeamAngle</a></li>
</ul>
<div align="center"> <img src="param_beamangle_1.png" alt="Beam angle preview" width="300px" class="inline"/> <br  />
<em>Top left: 90º. Top right: 180º. Bottom left: 270º. Bottom right: 360º.</em> </div> <h2><a class="anchor" id="autotoc_md18"></a>
DirectedLight parameters</h2>
<h3><a class="anchor" id="autotoc_md19"></a>
Beam width</h3>
<p >Maximum allowed distance from the center of the segment to a cast point.</p>
<ul>
<li><a class="el" href="classcandle_1_1DirectedLight.html#a0fd64d67dcfb9d1e34ebbc6b1d7f1b06" title="Get the width of the beam.">candle::DirectedLight::getBeamWidth</a></li>
<li><a class="el" href="classcandle_1_1DirectedLight.html#acd61088f6fc08cddcdcd98ec8362ac26" title="Set the width of the beam.">candle::DirectedLight::setBeamWidth</a></li>
</ul>
<div align="center"> <img src="param_beamwidth_1.png" alt="Beam width preview" width="300px" class="inline"/> <br  />
<em>Left: narrow beam. Right: wide beam.</em> </div><p> ​ <br  />
 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
